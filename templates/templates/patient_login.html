<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Patient Login - MedReferral</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; margin: 0; background:#f7fafc; }
        .container { max-width: 900px; margin: 0 auto; padding: 2rem; display: grid; grid-template-columns: 1fr 1fr; gap: 0; background:#fff; border-radius: 1rem; box-shadow: 0 10px 40px rgba(0,0,0,0.08); }
        .left { padding: 3rem; }
        .right { background: linear-gradient(135deg, #1c1c1c 0%, #4ba5ff 100%); color: #fff; padding: 3rem; display: flex; align-items: center; }
        .title { font-size: 2rem; font-weight: 800; margin: 0 0 .5rem; }
        .subtitle { color: #4a5568; margin: 0 0 2rem; }
        .form-group { margin-bottom: 1.25rem; }
        .label { display: block; font-weight: 600; margin-bottom: .5rem; }
        .input { width: 100%; padding: .8rem 1rem; border: 1px solid #e2e8f0; border-radius: .5rem; font-size: 1rem; }
        .btn { width: 100%; padding: .9rem 1.2rem; border: none; border-radius: .5rem; background: #4ba5ff; color: #fff; font-weight: 700; cursor: pointer; }
        .btn[disabled] { background:#a0aec0; cursor:not-allowed; }
        .flash { margin-bottom: 1rem; padding: 1rem; border-radius: .5rem; color: #fff; }
        .flash-danger { background:#ef4444; }
        .flash-success { background:#10b981; }
        .small { text-align:center; margin-top:1rem; color:#4a5568; }
        .small a { color:#4ba5ff; text-decoration:none; font-weight:600; }
        @media (max-width: 768px) { .container { grid-template-columns: 1fr; } .right { display:none; } }
    </style>
    </head>
<body>
    <main style="display:flex; align-items:center; justify-content:center; min-height:100vh; padding:1rem;">
        <div class="container">
            <section class="left">
                <h1 class="title">Patient Sign In</h1>
                <p class="subtitle">Access your referral and specialist recommendation.</p>

                <div class="flash-container">
                    {% with messages = get_flashed_messages(with_categories=true) %}
                        {% if messages %}
                            {% for category, message in messages %}
                                <div class="flash flash-{{ category }}">{{ message }}</div>
                            {% endfor %}
                        {% endif %}
                    {% endwith %}
                </div>

                <form id="patient-login-form">
                    <div class="form-group">
                        <label class="label" for="email">Email</label>
                        <input class="input" id="email" name="email" type="email" required>
                    </div>
                    <div class="form-group">
                        <label class="label" for="password">Password</label>
                        <input class="input" id="password" name="password" type="password" required>
                    </div>
                    <button class="btn" type="submit">Sign In</button>
                </form>

                <p class="small">Are you a clinician? <a href="/login">Log in here</a></p>
            </section>
            <aside class="right">
                <div>
                    <h2 style="margin:0 0 .75rem;">View your referral</h2>
                    <p style="margin:0; opacity:.95; line-height:1.6;">See your recommended specialist, referral details, and explanation in one place.</p>
                </div>
            </aside>
        </div>
    </main>

    <script>
    document.addEventListener('DOMContentLoaded', function() {
        const form = document.getElementById('patient-login-form');
        const flashContainer = document.querySelector('.flash-container');
        const button = form.querySelector('button[type="submit"]');

        form.addEventListener('submit', async function(e) {
            e.preventDefault();
            flashContainer.innerHTML = '';
            button.disabled = true; button.textContent = 'Signing in...';
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            try {
                const resp = await fetch('/patient/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json', 'X-Requested-With': 'XMLHttpRequest' },
                    body: JSON.stringify({ email, password })
                });
                const data = await resp.json();
                if (resp.ok && data.success) {
                    sessionStorage.setItem('access_token', data.access_token);
                    window.location.href = data.redirect_url || '/patient/dashboard';
                } else {
                    flashContainer.innerHTML = `<div class="flash flash-danger">${data.message || 'Login failed'}</div>`;
                    button.disabled = false; button.textContent = 'Sign In';
                }
            } catch (err) {
                flashContainer.innerHTML = '<div class="flash flash-danger">An error occurred. Please try again.</div>';
                button.disabled = false; button.textContent = 'Sign In';
            }
        });
    });
    </script>
</body>
</html>



