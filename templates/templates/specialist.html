<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ specialist }} - Specialist Details - MedReferral</title>
    <link rel="stylesheet" href="static/assets/css/base.css">
    <link rel="stylesheet" href="static/assets/css/components.css">
    <link rel="stylesheet" href="static/assets/css/utilities.css">
    <link rel="stylesheet" href="static/assets/css/chatbot.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Header -->
    <header class="header" role="banner">
        <nav class="nav" aria-label="Main navigation">
            <div class="nav-container">
                <a href="/" class="logo" aria-label="MedReferral Home">
                    <svg class="logo-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M12 2L2 7L12 12L22 7L12 2Z" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
                        <path d="M2 17L12 22L22 17" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
                        <path d="M2 12L12 17L22 12" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
                    </svg>
                    <span class="logo-text">MedReferral</span>
                </a>
                
                <div class="nav-links">
                    <a href="/" class="nav-link">Home</a>
                    <a href="/referral" class="nav-link">Referral</a>
                    <a href="/ranking" class="nav-link">Clinics</a>
                </div>
                
                <div class="auth-actions">
                    <a href="/logout" class="btn btn-outline">Log Out</a>
                </div>
            </div>
        </nav>
    </header>

    <!-- Main Content -->
    <main class="main" role="main">
        <div class="container">
            <div class="specialist-layout">
                <!-- Navigation -->
                <div class="breadcrumb mb-8">
                    <a href="/referral" class="btn btn-secondary">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M19 12H5M12 19L5 12L12 5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        Back to Results
                    </a>
                </div>

                <!-- Specialist Header -->
                <div class="specialist-header mb-8">
                    <div class="specialist-icon">
                        <svg width="48" height="48" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M20 6L9 17L4 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                    </div>
                    <div class="specialist-info">
                        <h1 class="specialist-title">{{ specialist }}</h1>
                        <p class="specialist-subtitle">Specialist recommendation based on clinical analysis</p>
                    </div>
                </div>

                <!-- Content Grid -->
                <div class="specialist-grid">
                    <!-- Explanation Card -->
                    <div class="card animate-fade-in">
                        <div class="card-header">
                            <h2 class="text-xl font-semibold">Clinical Reasoning</h2>
                        </div>
                        <div class="card-body">
                            {% if explanation %}
                                <p class="explanation-text">{{ explanation }}</p>
                            {% else %}
                                <p class="text-neutral-600">Referral recommendation for {{ specialist }} based on extracted clinical features.</p>
                            {% endif %}
                            
                            <div class="explanation-actions mt-6">
                                <button type="button" class="copy-btn btn btn-secondary" data-copy-text="{{ explanation or ('Referral recommendation for ' + specialist) }}">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <rect x="9" y="9" width="13" height="13" rx="2" ry="2" stroke="currentColor" stroke-width="2" fill="none"/>
                                        <path d="M5 15H4C2.89543 15 2 14.1046 2 13V4C2 2.89543 2.89543 2 4 2H13C14.1046 2 15 2.89543 15 4V5" stroke="currentColor" stroke-width="2" fill="none"/>
                                    </svg>
                                    Copy Explanation
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Distribution Card -->
                    {% if distribution %}
                    <div class="card animate-fade-in">
                        <div class="card-header">
                            <h2 class="text-xl font-semibold">All Recommendations</h2>
                            <p class="text-sm text-neutral-600">Complete probability distribution</p>
                        </div>
                        <div class="card-body">
                            <div class="distribution-chart">
                                {% for spec_name, percentage in distribution.items() %}
                                <div class="distribution-item {% if spec_name == specialist %}current-specialist{% endif %}">
                                    <div class="distribution-info">
                                        <span class="distribution-label">{{ spec_name }}</span>
                                        <span class="distribution-percentage">{{ percentage }}%</span>
                                    </div>
                                    <div class="distribution-bar">
                                        <div class="progress-bar">
                                            <div class="progress-fill" data-width="{{ percentage }}"></div>
                                        </div>
                                    </div>
                                </div>
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                    {% endif %}
                </div>

                <!-- Actions -->
                <div class="specialist-actions">
                    <a href="/ranking" class="btn btn-primary btn-large">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M21 10C21 17 12 23 12 23S3 17 3 10C3 5 7 1 12 1S21 5 21 10Z" stroke="currentColor" stroke-width="2"/>
                            <circle cx="12" cy="10" r="3" stroke="currentColor" stroke-width="2"/>
                        </svg>
                        See Ranked Clinics
                    </a>
                    <a href="/referral" class="btn btn-outline btn-large">New Analysis</a>
                </div>
            </div>
        </div>
    </main>

    <!-- Dr. Ellie Chatbot Widget -->
    {% include 'chatbot_widget.html' %}
    
    <!-- Scripts -->
    <script src="static/assets/js/main.js"></script>
    <script src="static/assets/js/charts.js"></script>
    <script src="static/assets/js/chatbot.js"></script>
</body>
</html>

<style>
/* Specialist page specific styles */
.specialist-layout {
    max-width: 800px;
    margin: 0 auto;
    padding: var(--space-8) var(--space-6);
}

.specialist-header {
    display: flex;
    align-items: center;
    gap: var(--space-6);
    padding: var(--space-8);
    background: linear-gradient(135deg, var(--primary-50) 0%, var(--secondary-50) 100%);
    border-radius: var(--radius-xl);
    border: 1px solid var(--primary-200);
}

.specialist-icon {
    background: white;
    padding: var(--space-4);
    border-radius: var(--radius-xl);
    color: var(--secondary-600);
    box-shadow: var(--shadow-md);
}

.specialist-title {
    font-size: var(--font-size-3xl);
    font-weight: 700;
    color: var(--neutral-900);
    margin-bottom: var(--space-2);
}

.specialist-subtitle {
    color: var(--neutral-600);
    font-size: var(--font-size-lg);
}

.specialist-grid {
    display: grid;
    gap: var(--space-6);
    margin-bottom: var(--space-8);
}

.current-specialist {
    background-color: var(--primary-50);
    border-radius: var(--radius-lg);
}

.current-specialist .distribution-label {
    color: var(--primary-700);
    font-weight: 600;
}

.current-specialist .progress-fill {
    background-color: var(--secondary-600);
}

.specialist-actions {
    display: flex;
    gap: var(--space-4);
    justify-content: center;
}

.explanation-actions {
    border-top: 1px solid var(--neutral-200);
    padding-top: var(--space-4);
}

@media (max-width: 768px) {
    .specialist-header {
        flex-direction: column;
        text-align: center;
        gap: var(--space-4);
    }
    
    .specialist-actions {
        flex-direction: column;
    }
    
    .specialist-layout {
        padding: var(--space-6) var(--space-4);
    }
}
</style>